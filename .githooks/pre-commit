#!/bin/bash

# 保護対象の重要なページファイル
PROTECTED_FILES=(
  "app/faq/page.tsx"
  "app/support/page.tsx"
  "app/updates/page.tsx"
  "app/legal/terms/page.tsx"
  "app/legal/privacy/page.tsx"
  "app/legal/tokusho/page.tsx"
  "app/contact/page.tsx"
)

# ステージングエリアで変更されたファイルをチェック
CHANGED_FILES=$(git diff --cached --name-only)

for file in "${PROTECTED_FILES[@]}"; do
  if echo "$CHANGED_FILES" | grep -q "^$file$"; then
    echo "❌ エラー: 保護されたファイル '$file' が変更されようとしています。"
    echo ""
    echo "このファイルは重要なページコンテンツを含むため、意図しない変更を防ぐために保護されています。"
    echo ""
    echo "このファイルを変更する場合は、以下の手順を実行してください："
    echo "  1. git commit --no-verify を使用して強制的にコミットする（推奨されません）"
    echo "  2. または、保護を解除してから変更する（推奨されません）"
    echo ""
    echo "誤って変更した場合は、バックアップから復元してください："
    filename=$(basename "$file" | sed 's|page.tsx|page.tsx|')
    backup_name=$(echo "$filename" | sed 's|page.tsx|page.tsx.backup|')
    if [[ "$file" == "app/faq/page.tsx" ]]; then
      backup_name="faq-page.tsx.backup"
    elif [[ "$file" == "app/support/page.tsx" ]]; then
      backup_name="support-page.tsx.backup"
    elif [[ "$file" == "app/updates/page.tsx" ]]; then
      backup_name="updates-page.tsx.backup"
    elif [[ "$file" == "app/legal/terms/page.tsx" ]]; then
      backup_name="terms-page.tsx.backup"
    elif [[ "$file" == "app/legal/privacy/page.tsx" ]]; then
      backup_name="privacy-page.tsx.backup"
    elif [[ "$file" == "app/legal/tokusho/page.tsx" ]]; then
      backup_name="tokusho-page.tsx.backup"
    elif [[ "$file" == "app/contact/page.tsx" ]]; then
      backup_name="contact-page.tsx.backup"
    fi
    echo "  cp backups/important-pages/$backup_name $file"
    echo ""
    exit 1
  fi
done

exit 0

