# E2Eテスト自動化

## 概要

PC版とモバイル版で同じ操作を自動実行し、結果を比較するE2Eテストシステムです。

## セットアップ

```bash
npm install
npx playwright install
```

## テストの実行

### 音声認識のE2Eテストを実行

```bash
npm run test:e2e:speech
```

### すべてのE2Eテストを実行

```bash
npm run test:e2e
```

### UIモードで実行（デバッグ用）

```bash
npm run test:e2e:ui
```

## テストの内容

### 音声認識E2Eテスト (`speech-recognition-e2e.spec.ts`)

1. **PC版のテスト**
   - デスクトップブラウザでページを開く
   - 隠しモードを起動（タイトルを3回クリック）
   - マイクボタンを3秒間長押し
   - ログを取得して結果を記録

2. **モバイル版のテスト**
   - モバイルブラウザ（iPhone 13エミュレーション）でページを開く
   - 隠しモードを起動（タイトルを3回クリック）
   - マイクボタンを3秒間タップ（長押し）
   - ログを取得して結果を記録

3. **結果の比較**
   - PC版とモバイル版の確定テキスト数を比較
   - エラー数を比較
   - 結果をコンソールに出力

## テスト結果の確認

テスト実行後、以下の情報が表示されます：

- PC版のセッションID、イベント数、確定テキスト、エラー
- モバイル版のセッションID、イベント数、確定テキスト、エラー
- 比較結果（確定テキスト数の差、エラー数の差）

## トラブルシューティング

### セッションIDが取得できない

- ログがデータベースに保存されるまで時間がかかる場合があります
- タイムアウト時間を延長するか、手動でログを確認してください

### マイクボタンが見つからない

- 隠しモードが正しく起動しているか確認してください
- セレクタが正しいか確認してください

### 音声認識が動作しない

- ブラウザのマイク権限が許可されているか確認してください
- 実際の音声入力が必要な場合は、テストを調整してください

## カスタマイズ

### テストのパラメータを変更

`tests/speech-recognition-e2e.spec.ts` を編集して、以下のパラメータを変更できます：

- `duration`: マイクボタンを長押しする時間（デフォルト: 3000ms）
- `timeout`: セッションID取得のタイムアウト（デフォルト: 15000ms）
- `viewport`: ブラウザのビューポートサイズ

